@inject HttpClient Client
@inject ILogHubAuthenticationService AuthenticationService

<AuthorizeView Roles="@UserRole.DataManager.ToString()">
    <Authorized>
        @if (OrganisationModel.Id == Guid.Empty)
        {
            <MudNavLink Href="organisations/create" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Add">New organisation</MudNavLink>
        }
        else
        {
            <MudDivider Class="my-2"/>
            <MudNavGroup Title="Organisations" Icon="@Icons.Material.Filled.Business">
                <MudNavGroup Title="@OrganisationModel.Name">
                    <MudNavLink Href="@GetUrl("department")" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Apartment">
                        Department List
                    </MudNavLink>
                    <MudNavLink Href="@GetUrl("user")" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.People">
                        User List
                    </MudNavLink>
                    <MudNavLink Href="@GetUrl("project")" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Science">
                        Project List
                    </MudNavLink>
                </MudNavGroup>
            </MudNavGroup>
        }
    </Authorized>
</AuthorizeView>

@code {
    OrganisationModel OrganisationModel { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var managerId = await AuthenticationService.GetUserIdAsync();
        OrganisationModel = await Client.GetFromJsonAsync<OrganisationModel>($"api/organisations/manager/{managerId}") ?? new OrganisationModel();
    }

    private string GetUrl(string objName)
    {
        return $"/organisations/{OrganisationModel.Id}/{objName}-list";
    }

}
