@page "/test/"

<h3>ImageUploador</h3>

<MudFileUpload T="IBrowserFile" Accept=".pdf" OnFilesChanged="@LoadImage" MaximumFileCount="100">
    <ButtonTemplate>
        @if (ImageUri == null)
        {
            <MudIconButton HtmlTag="label"
                           Color="Color.Info"
                           Icon="@Icons.Material.Filled.PhotoCamera"
                           for="@context">
            </MudIconButton>
        }
        else
        {
            <MudAvatar Size="Size.Large">
                <MudImage src="@ImageUri"/>
            </MudAvatar>
        }
    </ButtonTemplate >
</MudFileUpload>


@code {
    private string? ImageUri;

    public async Task LoadImage(InputFileChangeEventArgs inputFileChangeEventArgs)
    {
        var image = await inputFileChangeEventArgs.File.RequestImageFileAsync("image/png", 600, 600);

        await using var imageStream = image.OpenReadStream(1024 * 1024 * 10);

        using MemoryStream ms = new();
    // copy imageStream to Memory stream
        await imageStream.CopyToAsync(ms);

    // convert stream to base64
        ImageUri = $"data:image/png;base64,{Convert.ToBase64String(ms.ToArray())}";
        StateHasChanged();
    }

}
